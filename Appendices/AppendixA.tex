% Appendix Template

\chapter{Strand Spaces Model}\label{AppexA} % Main appendix title

\label{Strand Spaces Model} % Change X to a consecutive letter; for referencing this appendix elsewhere, use \ref{AppendixX}

\lhead{Appendix A. \emph{Strand Spaces Model}} % Change X to a consecutive letter; this is for the header on each page - perhaps a shortened title

In 1997, Fabrega, Herzog and Gutman developed a new method to prove a protocol if it achieves authentication and secrecy properties or not. First published internally as a technical report, the work went out public in a conference paper ~\cite{674832} in a year later. Following this approach, the authors continued maturing their model. Basic Strand Spaces theory was extended with \emph{honest idea}~\cite{Thayer:1998:HIS:794198.795096} which allows to learn general principles that limit penetrators' capabilities. After that, \emph{mixed strands}~\cite{Thayer:1999:MSS:794199.795113} was proposed to study problems of mixed protocols. One huge milestone of Strand Spaces theory is \emph{authentication tests}~\cite{Guttman:2002:ATS:568264.568267} proposed in 2000. In a study of cryptographic protocols, authors realized that after emitting a message containing a new value, a participant receives a cryptographic form of this value, this must exist a regular participant of the protocol sent it. This scheme, so called an authentication test, works as a powerful tool to minimise work of proving, and straightforwardly give results of authentication protocols. From 2002 to 2007, Strand Spaces theory was enriched with \emph{shape of bundle, skeleton and homomorphism}~\cite{Doghmi:2007:SHS:1230146.1230260}. These theories study about a sort of protocols that share the same forms. Current developments of Strand Spaces are focusing on various of types of protocols such as TLS~\cite{Kamil:2011:ATS:2590701.2590707}, location-awareness protocols~\cite{Thayer:2010aa}, and DH protocols~\cite{1212716}. 

Definitions used in thesis are referred from \cite{674832}, \cite{Guttman:2002:ATS:568264.568267} and~\cite{Doghmi:2007:SHS:1230146.1230260}. Furthermore, to make readers conformable with the theory, the Needham-Schroeder(NS) protocol~\cite{Needham:1978:UEA:359657.359659} presented below is used as an example through this part. 

\begin{enumerate}
\item $A \rightarrow B$: $\{N_a, A\}_{K_B}$
\item $B \rightarrow A$: $\{N_a,N_b, B\}_{K_A}$
\item $A \rightarrow B$: $\{N_b\}_{K_B}$
\end{enumerate}

\section{Fundamental Theory}

A security protocol is an ordered sequence of messages that participants exchange in a protocol. Let $\mathcal{A}$ a set of possible messages intentionally transferred in a security protocol, and elements of this set are referred to as \textit{terms}. Additionally, the set $\mathcal{A}$ is algebra freely generated from of a set of text terms $\mathcal{T}$ and a set of cryptographic keys $\mathcal{K}$ by means of concatenation and encryption. While $\mathcal{T}$ contains textual information such as nonces, $\mathcal{K}$ contains symmetric and/or asymmetric cryptographic keys. The two sets $\mathcal{T}$ and $\mathcal{K}$ are disjoint. 

\begin{Definition} $\emph{Compound terms}$ are generated by two operators
\begin{itemize}
	\item encr: $\mathcal{K} \times \mathcal{A} \rightarrow \mathcal{A}$ representing encryption
	\item join: $\mathcal{A} \times \mathcal{A} \rightarrow \mathcal{A}$ representing concatenation
\end{itemize}
\end{Definition}

For convention, from now we express the concatenation of two term $t$ and $t'$ as $\textit{t,t'}$ and encryption of term $t$ with key $K$ as $\{t\}_K$. We continue defining a relation, \textit{subterm relation}, on the set $\mathcal{A}$. 

\begin{Definition} The $\emph{subterm relation}$ $\sqsubseteq$ over $\mathcal{A}$ is defined inductively as: 
	\begin{itemize}
		\item $a \sqsubseteq t $ for $t \in \mathcal{T}$   iff $a = t $
		\item $a \sqsubseteq key $ for $t \in \mathcal{K}$   iff $a = key $
		\item $a \sqsubseteq gh $ iff $a \sqsubseteq gh, a \sqsubseteq h $ or $ a= h $
		\item $a \sqsubseteq \{g\}_K $ iff $a \sqsubseteq g $ or $a = \{g\}_K$
	\end{itemize} 
\end{Definition}

Remark that, $t_1\sqsubseteq t$ means $t_1$ is a subterm of $t$. A \textit{subterm} is just a term that can be easily extracted from a term with an appropriate key. In NS protocol, initiator $A$ starts sending to intentional responder $B$ a message (or a $term$) of the form $\{N_a,A\}_{K_B}$ where $K_B$ is the public key of $B$. Subterms of term $\{N_a,A\}_{K_B}$ could be $N_a, A$, or $\{N_a,A\}_{K_B}$. Since $K_B$ is a key, $K_B \not\sqsubseteq \{N_a,A\}_{K_B}$, except a case when $K_B$ is in a value of this message. 

Terms are extended to $\textit{signed term}$ including a positive represented to a transmission, and a negative one represented to a reception. 

\begin{Definition} A $\emph{signed term}$ is a pair $\langle\delta,a\rangle$ with $a \in A$ and $\delta$ one of the symbols $+,-$. We will write a signed term as $+t$ or $-t$. $(\pm A)^*$ is the set of finite sequences of signed terms. We denote a typical element of $(\pm A)^*$ by $\langle \delta_1,a_1\rangle,.....,\langle\delta_n,a_n\rangle$.
\end{Definition}

Note that, the unsigned term is the term without direction. For example, a signed term $+t$ has direction $+$, and an unsigned term $t$. 

A sequence of sending and receiving messages in a protocol is called $strand$, and a set of strands is called $\textit{Strand Spaces}$. 

When modeling a protocol, the strand of a principal is a sequence of events as seen by that principal in a particular protocol run and in a particular instance of role. For example, the strand of the initiator for the NS protocol is $\langle+\{N_a,A\}_{K_B}, -\{N_a,N_b\}_{K_A},+\{N_b\}_{K_B} \rangle$. The first event is emission of $\{N_a,A\}_{K_B}$ followed by reception of $\{N_a,N_b\}_{K_A}$ and so on. 

\begin{Definition}
A $\emph{Strand Spaces}$ is a set $\Sigma$ with a trace mapping tr: $\Sigma \rightarrow (\pm A)^*$.
\end{Definition}

For a Strand Spaces $\Sigma$:

	\begin{itemize}
		\item A node is a pair $\langle s,i\rangle$, with $s \in \Sigma$ and i an integer satisfying $1\leq i \leq length(tr(s))$. The set of nodes is denoted by $\mathcal{N}$. We will say the node $n= \langle s,i\rangle$ belongs to the strand s. Clearly, every node belongs to a unique strand. 

		\item If $n= \langle s,i \rangle \in \mathcal{N}$ then $index(n) = i$ and $strand(n)=s$. Define $term(n)$ to be $(tr(s))_i$, i.e. the $i^{th}$ signed term in the trace of $s$. Similarly, $uns\_term(n)$ is $((tr(s))_i)_2$, i.e. the unsigned part of the $i^{th}$ signed term in the trace of $s$

		\item If $n,n' \in \mathcal{N}, n \rightarrow n'$ mean $term(n) = +a$ and $term(n') = +a$ It means that node $n$ sends the message $a$ which is received by $n'$, creating a causal link between their strands.

		\item If $n,n' \in \mathcal{N}, n \Rightarrow n'$ mean $n$ and $n'$ occur on the same strand with $index(n)=index(n') -1 $. It expresses that $n$ is an immediate causal predecessor of $n'$ on the strand. 
		
		\item $n \Rightarrow^+ n'$ to mean that $n$ precedes $n'$ (not necessarily immediately) on the same strand.
			
		\item $m \Rightarrow^* n$ means $m \rightarrow n_1 \Rightarrow m_2 \rightarrow n_2 \Rightarrow ......m_k \rightarrow n$ where $n_i, m_i$, and n stand on the same or different strands. A \emph{path} created by $m \Rightarrow^* n$ forms a connectivity subgraph in the bundle. 

		\item An unsigned term $t$ $occurs$ in $n \in \mathcal{N}$ if $t \sqsubseteq term(n)$.

		\item An unsigned term $t$ $originates$ on $n \in \mathcal{N}$ iff:$term(n)$ is positive, $t \sqsubseteq term(n)$, and whenever $n$ precedes $n$ on the same strand, $t \not\sqsubseteq term(n)$.

		\item An unsigned term $t$ is $\textit{uniquely originating}$ iff $t$ originates on a unique $n \in \mathcal{N}$ 

	\end{itemize}

Let  the Initiator strand be $st = \langle +\{N_a,A\}_{K_B}, -\{N_a,N_b\}_{K_A},+\{N_b\}_{K_B} \rangle$, and the responder strand be $st' = \langle -\{N_a,A\}_{K_B}, +\{N_a,N_b\}_{K_A},-\{N_b\}_{K_B} \rangle$.

The first node of Initiator strand is $\langle st,1 \rangle = +\{N_a,A\}_{K_B}$. Moreover, $\langle st,1 \rangle \Rightarrow \langle st,2 \rangle$ means node $\langle st,1 \rangle$ is a causal predecessor of node $\langle st,2 \rangle$. $N_a$ occurs in $term(\langle st,1 \rangle)$. Additionally, since sign of $\langle st,1 \rangle$ is positive, and there does not exist any predecessor of $\langle st,1 \rangle$, $N_a$ uniquely originates at $\langle st,1 \rangle$.  
	
Let $\mathcal{N}$ be a set of nodes, and let $\mathcal{E}$ be the union of the sets of $\rightarrow$ and $\Rightarrow$ edges. A directed graph $\mathcal{G}$ has a structure $\mathcal{G} = \langle \mathcal{N},\mathcal{E}\rangle$. A $bundle$ is a finite subgraph of this graph in which the edges express casual dependencies of the nodes.

\begin{Definition} Suppose $\mathcal{N_B}$ be a subset of $\mathcal{N}$, and $\mathcal{E_B}$ be a subset of $\mathcal{E}$. Let $\mathcal{B} = \langle \mathcal{N_B},\mathcal{E_B}\rangle$ be a subgraph of $\mathcal{G}$. $\mathcal{B}$ is a $\emph{bundle}$ if :
\begin{enumerate}
\item $\mathcal{N_B}$ and $\mathcal{E_B}$ are finite
\item If $n \in \mathcal{N_B}$ and $term(n)$ is negative, then there is a unique $n'$ such that $ n' \rightarrow n \in \mathcal{E_B}$
\item If $n \in \mathcal{N_B}$ and $n \Rightarrow n'$ then $n \Rightarrow n' \in \mathcal{E_B}$ 
\item $\mathcal{B}$ is acyclic
\end{enumerate}
\end{Definition}

The graph consisting of the Initiator strand $st$ and responder strand $st'$ is called a NS bundle. Remarking that Guttman implicitly expressed that when a node transmits a message, there is more than one (or none) receiving node of the message. However, we hardly see more than two receptions in their studies. 

\begin{Definition}
A node $n$ belongs to a bundle $\mathcal{B} = \langle \mathcal{N_B},\mathcal{E_B}\rangle$ , written $n \in \mathcal{B}$ if $n \in \mathcal{N_B}$. The $\mathcal{B} -height$ of a strand $s \in \mathcal{B}$ is the largest $i$ such that $\langle s,i \rangle \in \mathcal{B}$. 
\end{Definition}

For instance, in NS protocol, $\mathcal{B}-height$ of initiator strand is 3, similarly $\mathcal{B}-height$ of responder strand is also 3.

%introduce component
\section{Component, Authentication Tests}

After introducing Strand Spaces fundamental theory, basing on the fact that security authentication protocols usually use specific challenge-response methods to obtain goals, Thayer et al\cite{authenticationtests} continued publishing a theory of $\textit{authentication tests}$ as a tool to prove security properties for protocols easily. 

\begin{Definition}
 A term $t'$ is called a \emph{component} of term $t$ if $t'$ cannot be split to another term $t''$, and $t$ is built by concatenating $t'$ with arbitrary terms.
\end{Definition}

Conveniently, we refer the example of Thayer\cite{Thayer:2010aa}. If we have a term like $B\{N_aK\{KN_b\}_{K_B}\}_{K_A}N_a$, then it contains three components: $B, \{N_aK\{KN_b\}_{K_B}\}_{K_A}$, and $N_a$. 
 
\begin{Definition}
 For a strand s, a term t is \emph{new} at $n = \langle s,i\rangle$ if t is a component of term(n), but t is not a component of node $\langle s,j\rangle$ for every $j<i$. 
\end{Definition}

Taking NS protocol as an example, the component $\{N_a,N_b,B\}_{K_B}$ is new at node $\langle st,2 \rangle$ since it is clearly not a component of $\langle st,1 \rangle$. 

\begin{Definition} Suppose that $n \in \mathcal{B}$ is positive, $\emph{a}$ $\in \mathcal{A}$ is a subterm of $term(n)$. The edge $n \Rightarrow^+ n'$ is a \emph{transformed edge} for $\emph{a}$ if there exits a negative node $n' \in \mathcal{B}$, and there is a new component $t_2$ of $n'$ such that $a \sqsubseteq t_2$.
\end{Definition}

Respectively, \textit{a transforming edge} is denoted.

\begin{Definition} Suppose that $n \in \mathcal{B}$ is negative, $\emph{a}$ $\in \mathcal{A}$ is a subterm of $term(n)$. The edge $n \Rightarrow^+ n'$ is a \emph{transforming edge} for $\emph{a}$ if there exits a positive node $n' \in \mathcal{B}$, and there is a new component $t_2$ of $n'$ such that $a \sqsubseteq t_2$.
\end{Definition}

 For example, the edge $\langle st,1\rangle \Rightarrow \langle st,2\rangle$ is a transformed edge for the term $N_a$, and  $\langle st',1\rangle \Rightarrow \langle st',2\rangle$ is a transforming edge for $N_a$. 

\begin{Definition} 
The edge $n \Rightarrow^+ n'$ is \emph{a test} for $\emph{a}$ $\in \mathcal{A}$ if $\emph{a}$ uniquely originates at $n$, and $n \Rightarrow^+ n'$ is a transformed edge for $\emph{a}$. 
\end{Definition}

The transformed edge $\langle st,1\rangle \Rightarrow \langle st,2\rangle$ is a test for $N_a$ since $N_a$ uniquely originates at $\langle st,1\rangle$. 

\begin{Definition} Suppose that $n, n' \in \mathcal{B}$.
\begin{enumerate}
\item The edge $n \Rightarrow^+ n'$ is \emph{a outgoing test} for $a$ $\sqsubseteq t = \{h\}_K$ if it is a test for $a$ in which $K^{-1} \not\in P$, $a$ does not occur in any component of $n$ other than t. Moreover, $t$ is a test component for $a$ in $n$.
\item The edge $n \Rightarrow^+ n'$ is \emph{a incoming test} for $a$ $\sqsubseteq t_1 = \{h\}_K$ if it is a test for $a$ in which $K \not\in P$, and $t_1$ is a test component for $a$ in $n'$.
\end{enumerate}
\end{Definition}

The transformed edge $\langle st,1\rangle \Rightarrow \langle st,2\rangle$ could be considered as an incoming test for $N_a$. 

Subsequently, authentication tests~\cite{authenticationtests} are provided as powerful and simple tools to guarantee existence of regular strands in a bundle. 

\emph{Authentication Test 1}: Suppose that $n' \in \mathcal{B}$, and $n \Rightarrow^+ n'$ is outgoing test for $\emph{a}$ $\sqsubseteq t$ with $t = term(n)$. Then there exist regular nodes $m,m' \in \mathcal{B}$ such that $t$ is a component of $m$, and  $m \Rightarrow^+m'$ is a transforming edge for $\emph{a}$. In addition that $\emph{a}$ occurs only in component $t_1=\{h_1\}_{K_1}$ of $m'$, that $t_1$ is not a proper subterm of any regular component, and that $K^{-1}_1 \not\in P$. There is a negative regular node with $t_1$ as a component. 


\emph{Authentication Test 2}: Suppose that $n \in \mathcal{B}$, and $n \Rightarrow^+ n'$ is incoming test for $\emph{a}$ $\sqsubseteq t'$ with $t' = term(n')$. Then there exist regular nodes $m,m' \in \mathcal{B}$ such that $t'$ is a component of $m'$, and  $m \Rightarrow^+m'$ is a transforming edge for $\emph{a}$. 

\begin{Definition} 
A negative node is an \emph{unsolicited test} for $t = \{h\}_K$ if $t$ is a test component for any $a$ in $n$ and $K \not\in P$. 
\end{Definition}

\emph{Authentication Test 3}: Suppose that a node $n$ is in a bundle $\mathcal{B}$, and $n$ be an unsolicited test for $t = \{h\}_K$, then there exists a positive regular node $m \in \mathcal{B}$ such that $t$ is a component of $m$. 
 
The proofs of these authentication tests are out of scope in this part. So if readers eager to deeply understand the proofs, please regard to the paper \cite{Guttman:2002:ATS:568264.568267}.


\section{Shape and Skeleton}

In design protocol, ones always desire that there is only one possible execution of their protocol in any scenario. Nevertheless, there might exist some executions relative to the protocol's assumptions. Actually, the executions of protocols normally have very few essentially different forms that called $shapes$. Then, authentication and secrecy properties can be determined by examining the shapes.

Precisely, a shape is a local execution by honest principals. Partial information about a principal's execution of a protocol is called \emph{skeleton}. Skeletons are partial-ordered structures, or fragments of message sequence chart. Moreover, a skeleton is $realised$ if it is not fragmented, i.e. it contains exactly the regular behavior of some executions. A realised skeleton is a shape if it is minimal. 

A preskeleton describes the regular parts of a set of bundles. Formally presented, preskeleton is defined as follows.
\begin{Definition}[Skeleton]A four-tuple $\mathcal{A} = (node, \preceq, non, unique)$ is a preskeleton if:
	\begin{enumerate}
	\item $node$ is a finite set of regular nodes, $n_1 \in node$ and $n_0 \Rightarrow^+ n_1$ implies $n_0 \in nodes$;
	\item $\preceq$ is a partial ordering on $node$ such that $n_0 \Rightarrow^+ n_1$ imples $n_0 \preceq n_1$;
	\item $non$ is a set of keys where if $K \in non$, then for all $n \in node, K\not\sqsubseteq term(n)$, and for some $n' \in node$, either $K$ or $K^{-1}$ is used in $term(n')$;
	\item $unique$ is a set of atoms where $a \in unique$, for some $n \in node, a \sqsubseteq term(n)$. 
	\end{enumerate}
	A preskeleton $\mathcal{A}$ is a $skeleton$ if in addition:
	\begin{enumerate}
	\item[4'.] $a\in unique$ implies $a$ originates at no more than one $n\in node$. 
	\end{enumerate}
\end{Definition}

\begin{Definition}[Shape] $\mathcal{A}'$ is a $shape$ for $\mathcal{A}$ if (1) some $H : \mathcal{A} \rightarrow \mathcal{A'}$, (2) $\mathcal{A'}$ is realised, and (3) no proper skeleton of $\mathcal(A')$ satisfies (1) and (2). 
\end{Definition}

A strand could be considered as a skeleton. And a bundle could be considered as a shape. Furthermore, a bundle containing a penetrator strand is also a possible shape of the protocol. 

\section{Penetrator Model}

Original Strand Spaces theory uses Dolev-Yao \cite{dolev-yao} model as its penetrator model. Penetrator's power is built up from two ingredients: initially known keys available to the penetrator, and actions that allows the penetrator manipulates messages. The actions are summarized to discard message, to generate arbitrary messages, to concatenate messages together, and to apply cryptographic operation using available keys. The model is described as follows. 

\begin{Definition} A penetrator trace is \emph{one of the following}:
\begin{itemize}
\item[\textbf{M}.] Text message: $\langle+t\rangle$ where $t \in T$
\item[\textbf{F.}] Flushing: $\langle-g\rangle$ 
\item[\textbf{T.}] Tee: $\langle-g,+g,+g\rangle$
\item[\textbf{C.}] Concatenation $\langle-g,-h,+gh\rangle$
\item[\textbf{S.}] Separation into components: $\langle-gh,+g,+h\rangle$
\item[\textbf{K.}] Key: $\langle+K\rangle$ where $K \in \mathcal{K_P}$
\item[\textbf{E.}] Encryption: $\langle-K,-h,+\{h\}_K\rangle$
\item[\textbf{D.}] Decryption: $\langle-K^{-1},-\{h\}_K,+h\rangle$
\end{itemize} 
\end{Definition}

This penetrator's trace set given here could be extended if desired without any modification on the whole model. However, the proofs should be adjusted to take into account the additional penetrator traces. This ability gives us an open space to add some physical penetrator traces without worry of proving way. 

